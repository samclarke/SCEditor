/*!pl SCEditor | (C) 2011-2013, Sam Clarke | sceditor.com/license */
(function(t){"use strict";t.sceditor.XHTMLSerializer=function(){var e,n,i,r,o,s,a,c,l,u,d,v=this,f={indentStr:"	"},m=[],g=0;e=function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return t?t.replace(/[&<>"]/g,function(t){return e[t]||t}):""},n=function(t){return t.replace(/[\r\n]/,"").replace(/[^\S|\u00A0]+/g," ")},v.serialize=function(t,e){if(m=[],e)for(t=t.firstChild;t;)i(t),t=t.nextSibling;else i(t);return m.join("")},i=function(t){switch(t.nodeType){case 1:var e=t.nodeName.toLowerCase();"!"===e&&a(t),o(t);break;case 3:c(t);break;case 4:s(t);break;case 8:a(t);break;case 9:case 11:r(t);break;case 2:case 5:case 6:case 7:case 10:case 12:}},r=function(t){var e;for(e=t.firstChild;e;)i(e),e=e.nextSibling},o=function(t){var n,r,o=t.nodeName.toLowerCase(),s=t.attributes.length,a=!t.firstChild&&/^(?:area|base|br|col|embed|hr|img|input|link|meta|param)$/.test(o);for(u(t)&&l(),m.push("<"+o);s--;)r=t.attributes[s],m.push(" ",r.name.toLowerCase(),'="',e(r.value),'"');for(m.push(a?" />":">"),g++,n=t.firstChild;n;)i(n),n=n.nextSibling;g--,a||(u(t)&&t.firstChild&&l(),m.push("</",o,">"))},s=function(t){l(),m.push("<![CDATA[",e(t.nodeValue),"]]>")},a=function(t){l(),m.push("<!-- ",e(t.nodeValue)," -->")},c=function(t){var i=n(t.nodeValue);i&&(u(t)&&l(),m.push(e(i)))},l=function(){var t=g;for(d();t--;)m.push(f.indentStr)},u=function(e){if(1!==e.nodeType){if(e.previousSibling&&t.sceditor.dom.isInline(e.previousSibling))return!1;e=e.parentNode}return e.previousSibling||t.sceditor.dom.isInline(e.parentNode)?!t.sceditor.dom.isInline(e):!0},d=function(){m.length&&m.push("\n")}},t.sceditor.plugins.xhtml=function(){var e,n,i,r,o,s,a=this,c={},l={};a.init=function(){t.isEmptyObject(t.sceditor.plugins.xhtml.converters||{})||t.each(t.sceditor.plugins.xhtml.converters,function(e,n){t.each(n.tags,function(t){c[t]||(c[t]=[]),c[t].push(n)})}),e(this)},e=function(e){var n={bold:{txtExec:["<strong>","</strong>"]},italic:{txtExec:["<em>","</em>"]},underline:{txtExec:['<span style="text-decoration: underline;">',"<span>"]},strike:{txtExec:['<span style="text-decoration: line-through;">',"<span>"]},subscript:{txtExec:["<sub>","</sub>"]},superscript:{txtExec:["<sup>","</sup>"]},left:{txtExec:['<div style="text-align: left;">',"<div>"]},center:{txtExec:['<div style="text-align: center;">',"<div>"]},right:{txtExec:['<div style="text-align: right;">',"<div>"]},justify:{txtExec:['<div style="text-align: justify;">',"<div>"]},font:{txtExec:function(e){var n=this;t.sceditor.command.get("font")._dropDown(n,e,function(t){n.insertText('<span style="font-family: '+t+';">',"</span>")})}},size:{txtExec:function(e){var n=this;t.sceditor.command.get("size")._dropDown(n,e,function(t){n.insertText('<span style="font-size: '+t+';">',"</span>")})}},color:{txtExec:function(e){var n=this;t.sceditor.command.get("color")._dropDown(n,e,function(t){n.insertText('<span style="color: '+t+';">',"</span>")})}},bulletlist:{txtExec:["<ul><li>","</li></ul>"]},orderedlist:{txtExec:["<ol><li>","</li></ol>"]},table:{txtExec:["<table><tr><td>","</td></tr></table>"]},horizontalrule:{txtExec:["<hr />"]},code:{txtExec:["<code>","</code>"]},image:{txtExec:function(t,e){var n=prompt(this._("Enter the image URL:"),e);n&&this.insertText('<img src="'+n+'" />')}},email:{txtExec:function(t,e){var n=e&&e.indexOf("@")>-1?null:e,i=prompt(this._("Enter the e-mail address:"),n?"":e),r=prompt(this._("Enter the displayed text:"),n||i)||i;i&&this.insertText('<a href="mailto:'+i+'">'+r+"</a>")}},link:{txtExec:function(t,e){var n=e&&e.indexOf("http://")>-1?null:e,i=prompt(this._("Enter URL:"),n?"http://":e),r=prompt(this._("Enter the displayed text:"),n||i)||i;i&&this.insertText('<a href="'+i+'">'+r+"</a>")}},quote:{txtExec:["<blockquote>","</blockquote>"]},youtube:{txtExec:function(e){var n=this;t.sceditor.command.get("youtube")._dropDown(n,e,function(t){n.insertText('<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="'+t+'" frameborder="0" allowfullscreen></iframe>')})}},rtl:{txtExec:['<div stlye="direction: rtl;">',"</div>"]},ltr:{txtExec:['<div stlye="direction: ltr;">',"</div>"]}};e.commands=t.extend(!0,{},n,e.commands)},a.signalToSource=function(e,i){return i=i.jquery?i[0]:i,t(i).find(".sceditor-selection").remove(),n(i),r(i),s(i),(new t.sceditor.XHTMLSerializer).serialize(i,!0)},a.signalToWysiwyg=function(t){return t},a.convertTagTo=function(t,e){for(var n,i,r=t.attributes.length,o=t.ownerDocument.createElement(e);r--;)i=t.attributes[r],o.setAttribute(i.name,i.value);for(;n=t.firstChild;)o.appendChild(n);return t.parentNode.replaceChild(o,t),o},i=function(e,n){c[e]&&t.each(c[e],function(i,r){r.tags[e]?t.each(r.tags[e],function(e,i){void 0!==n.attr(e)&&(i&&0>t.inArray(n.attr(e),i)||r.conv.call(a,n[0]))}):r.conv&&r.conv.call(a,n[0])})},n=function(e){c&&t.sceditor.dom.traverse(e,function(e){var n=t(e),r=e.nodeName.toLowerCase();c&&(i("*",n),i(r,n))},!0)},r=function(e){t.sceditor.dom.traverse(e,function(e){var n=e.nodeName.toLowerCase(),i=t.sceditor.plugins.xhtml.allowedTags,r=t.sceditor.plugins.xhtml.disallowedTags;4===e.nodeType?n="!cdata":("!"===n||8===e.nodeType)&&(n="!comment"),i&&i.length&&3!==e.nodeType?0>t.inArray(n,i)&&e.parentNode&&e.parentNode.removeChild(e):r&&r.length&&3!==e.nodeType&&t.inArray(n,r)>-1&&e.parentNode&&e.parentNode.removeChild(e)})},o=function(e,n){var i={};return e&&t.extend(i,e),n?(t.each(n,function(e,n){t.isArray(i[e])?t.isArray(n)&&(i[e]=t.merge(i[e],n)):i[e]=n}),i):i},s=function(e){l={},t.sceditor.dom.traverse(e,function(e){if(e.attributes){var n,i,r=e.nodeName.toLowerCase(),s=t.sceditor.plugins.xhtml.allowedAttribs,a=t.sceditor.plugins.xhtml.disallowedAttribs,c=e.attributes.length;if(s&&!t.isEmptyObject(s)&&c)for(l[r]||(l[r]=o(s["*"],s[r]));c--;)n=e.attributes[c],i=l[r][n.name]===void 0,t.isArray(l[r][n.name])&&0>t.inArray(n.value,l[r][n.name])&&(i=!0),i&&e.removeAttribute(n.name);else if(a&&!t.isEmptyObject(a)&&c)for(l[r]||(l[r]=o(a["*"],a[r]));c--;)n=e.attributes[c],i=l[r][n.name]!==void 0,t.isArray(l[r][n.name])&&t.inArray(n.value,l[r][n.name])>-1&&(i=!0),i&&e.removeAttribute(n.name)}})}},t.sceditor.plugins.xhtml.converters=[{tags:{"*":{width:null}},conv:function(e){var n=t(e);n.css("width",n.attr("width")).removeAttr("width")}},{tags:{"*":{height:null}},conv:function(e){var n=t(e);n.css("height",n.attr("height")).removeAttr("height")}},{tags:{li:{value:null}},conv:function(e){t(e).removeAttr("value")}},{tags:{"*":{text:null}},conv:function(e){var n=t(e);n.css("color",n.attr("text")).removeAttr("text")}},{tags:{"*":{size:null}},conv:function(e){var n=t(e);n.css("font-size",n.css("font-size")).removeAttr("size")}},{tags:{"*":{color:null}},conv:function(e){var n=t(e);n.css("color",n.attr("color")).removeAttr("color")}},{tags:{"*":{face:null}},conv:function(e){var n=t(e);n.css("font-family",n.attr("face")).removeAttr("face")}},{tags:{"*":{language:null}},conv:function(e){var n=t(e),i=n.attr("language");/jscript|javascript|js/i.test(i)?n.attr("type","text/javascript"):/vb/i.test(i)&&n.attr("type","text/vbscript"),n.removeAttr("language")}},{tags:{"*":{align:null}},conv:function(e){var n=t(e);n.css("text-align",n.attr("align")).removeAttr("align")}},{tags:{"*":{border:null}},conv:function(e){var n=t(e);n.css("border-size",n.attr("border")).removeAttr("border")}},{tags:{applet:{name:null},img:{name:null},layer:{name:null},map:{name:null},object:{name:null},param:{name:null}},conv:function(e){t(e).removeAttr("name")}},{tags:{hr:{noshade:null}},conv:function(e){var n=t(e);n.css("border-style","solid").removeAttr("noshade")}},{tags:{"*":{nowrap:null}},conv:function(e){var n=t(e);n.css("white-space","nowrap").removeAttr("nowrap")}},{tags:{big:null},conv:function(e){t(this.convertTagTo(e,"span")).css("font-size","larger")}},{tags:{small:null},conv:function(e){t(this.convertTagTo(e,"span")).css("font-size","smaller")}},{tags:{b:null},conv:function(e){t(this.convertTagTo(e,"strong"))}},{tags:{u:null},conv:function(e){t(this.convertTagTo(e,"span")).css("text-decoration","underline")}},{tags:{i:null},conv:function(e){t(this.convertTagTo(e,"em"))}},{tags:{s:null,strike:null},conv:function(e){t(this.convertTagTo(e,"span")).css("text-decoration","line-through")}},{tags:{dir:null},conv:function(t){this.convertTagTo(t,"ul")}},{tags:{center:null},conv:function(e){t(this.convertTagTo(e,"div")).css("text-align","center")}},{tags:{font:null},conv:function(t){this.convertTagTo(t,"span")}}],t.sceditor.plugins.xhtml.allowedAttribs={},t.sceditor.plugins.xhtml.disallowedAttribs={},t.sceditor.plugins.xhtml.allowedTags=[],t.sceditor.plugins.xhtml.disallowedTags=[]})(jQuery);