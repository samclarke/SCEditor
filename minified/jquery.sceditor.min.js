(function(a,b,c){"use strict";var d={html:'<!DOCTYPE html><html><head><style>.ie * {min-height: auto !important}</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true"></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" value="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" value="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" value="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'},e=function(b,c,e){var f=d[b];return a.each(c,function(a,b){f=f.replace(new RegExp("\\{"+a+"\\}","g"),b)}),e&&(f=a(f)),f};a.sceditor=function(d,f){var g=this,h=d.get?d.get(0):d,i=a(h),j,k,l,m,n,o,p,q=[],r,s,t=[],u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;g.commands=a.extend({},f.commands||a.sceditor.commands),w=function(){i.data("sceditor",g),g.opts=a.extend({},a.sceditor.defaultOptions,f),g.opts.locale&&g.opts.locale!=="en"&&O();var d=g.opts.height,e=g.opts.width;(d&&(d+"").indexOf("%")>-1||e&&(e+"").indexOf("%")>-1)&&a(b).resize(N),j=a('<div class="sceditor-container" />').insertAfter(i),G(),F(),H(),g.opts.resizeEnabled&&I(),g.opts.id&&j.attr("id",g.opts.id),a(c).click(J),a(h.form).attr("novalidate","novalidate").bind("reset",D).submit(K),g.val(i.hide().val()),g.opts.autofocus&&S(),a.sceditor.isWysiwygSupported||g.toggleSourceMode(),g.opts.toolbar.indexOf("emoticon")!==-1&&L();if(g.opts.autoExpand)var k=setInterval(function(){if(!c.readyState||c.readyState==="complete")g.expandToContent(),clearInterval(k)},10)},F=function(){var c,d;n=a("<textarea></textarea>").hide(),l=a('<iframe frameborder="0"></iframe>'),b.location.protocol==="https:"&&l.attr("src","javascript:false"),j.append(l).append(n),m=l[0],o=n[0],g.width(g.opts.width||i.width()),g.height(g.opts.height||i.height()),M().open(),M().write(e("html",{charset:g.opts.charset,style:g.opts.style})),M().close(),g.readOnly(!!g.opts.readOnly),c=a(M()),d=c.find("body"),a.sceditor.ie&&c.find("html").addClass("ie").addClass("ie"+a.sceditor.ie),(/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent)||a.sceditor.ie)&&d.height("100%"),d.keypress(C).keyup(R),c.keypress(C).mousedown(E).bind("beforedeactivate keyup",z).keyup(R).focus(function(){r=null}),g.opts.autoUpdate&&(d.bind("blur",g.updateOriginal),c.bind("blur",g.updateOriginal)),g.opts.rtl&&(d.attr("dir","rtl"),n.attr("dir","rtl")),g.opts.enablePasteFiltering&&d.bind("paste",A),g.opts.autoExpand&&c.bind("keyup",g.expandToContent),u=new a.sceditor.rangeHelper(m.contentWindow)},G=function(){var b,c,d,f,h,i,l=g.opts.toolbar.split("|");i=function(){var b=a(this);return b.hasClass("disabled")||y(b,g.commands[b.data("sceditor-command")]),!1},k=a('<div class="sceditor-toolbar" />');for(f=0;f<l.length;f++){b=a('<div class="sceditor-group" />'),d=l[f].split(",");for(h=0;h<d.length;h++){if(!g.commands[d[h]])continue;c=e("toolbarButton",{name:d[h],dispName:g.commands[d[h]].tooltip||d[h]},!0).click(i).data("sceditor-txtmode",!!g.commands[d[h]].txtExec).data("sceditor-wysiwygmode",!!g.commands[d[h]].exec),g.commands[d[h]].tooltip&&c.attr("title",g._(g.commands[d[h]].tooltip)),g.commands[d[h]].exec||c.addClass("disabled"),b.append(c)}k.append(b)}g.opts.toolbarContainer?a(g.opts.toolbarContainer).append(k):j.append(k)},S=function(){var a,b=m.contentWindow.document,c=b.body;if(!b.createRange)return g.focus();if(!c.firstChild)return;a=b.createRange(),a.setStart(c.firstChild,0),a.setEnd(c.firstChild,0),u.selectRange(a),c.focus()},g.readOnly=function(a){return typeof a!="boolean"?n.attr("readonly")==="readonly":(M().body.contentEditable=!a,a?n.attr("readonly","readonly"):n.removeAttr("readonly"),P(a),this)},P=function(b){var c=g.inSourceMode();k.find(".sceditor-button").removeClass("disabled").each(function(){var d=a(this);b===!0||c&&!d.data("sceditor-txtmode")?d.addClass("disabled"):!c&&!d.data("sceditor-wysiwygmode")&&d.addClass("disabled")})},H=function(){a.each(g.commands,function(a,b){b.keyPress&&q.push(b.keyPress)})},g.width=function(a){return a?(g.width()!==a&&(j.width(a),l.width(a),l.width(a+(a-l.outerWidth(!0))),n.width(a),n.width(a+(a-n.outerWidth(!0)))),this):j.width()},g.height=function(a){return a?(g.height()!==a&&(j.height(a),a-=g.opts.toolbarContainer?0:k.outerHeight(!0),l.height(a),l.height(a+(a-l.outerHeight(!0))),n.height(a),n.height(a+(a-n.outerHeight(!0)))),this):j.height()},g.expandToContent=function(a){var b=M(),c=j.height(),d=b.body.scrollHeight||b.documentElement.scrollHeight,e=c-l.height(),f=g.opts.resizeMaxHeight||(g.opts.height||i.height())*2;d+=e,a!==!0&&d>f&&(d=f),d>c&&g.height(d)},I=function(){var b,d,e,f,h,i=a('<div class="sceditor-grip" />'),k=a('<div class="sceditor-resize-cover" />'),l=0,m=0,n=0,o=0,p=j.width(),q=j.height(),r=!1;b=g.opts.resizeMinHeight||q/1.5,d=g.opts.resizeMaxHeight||q*2.5,e=g.opts.resizeMinWidth||p/1.25,f=g.opts.resizeMaxWidth||p*1.25,h=function(a){var c=o+(a.pageY-m),h=n+(a.pageX-l);f>0&&h>f&&(h=f),d>0&&c>d&&(c=d),g.opts.resizeWidth&&h>=e&&(f<0||h<=f)&&g.width(h),g.opts.resizeHeight&&c>=b&&(d<0||c<=d)&&g.height(c),a.preventDefault()},j.append(i),j.append(k.hide()),i.mousedown(function(b){l=b.pageX,m=b.pageY,n=j.width(),o=j.height(),r=!0,j.addClass("resizing"),k.show(),a(c).bind("mousemove",h),b.preventDefault()}),a(c).mouseup(function(b){if(!r)return;r=!1,k.hide(),j.removeClass("resizing"),a(c).unbind("mousemove",h),b.preventDefault()})},K=function(b){g.updateOriginal(),a(this).removeAttr("novalidate"),this.checkValidity&&!this.checkValidity()&&b.preventDefault(),a(this).attr("novalidate","novalidate"),g.blur()},g.destroy=function(){a(c).unbind("click",J),a(b).unbind("resize",N),a(h.form).removeAttr("novalidate").unbind("submit",K).unbind("reset",D),a(M()).find("*").remove(),a(M()).unbind("keypress mousedown beforedeactivate keyup focus paste keypress"),j.find("*").remove(),j.remove(),i.removeData("sceditor").removeData("sceditorbbcode").show()},L=function(){g.opts.emoticonsRoot&&g.opts.emoticons&&a.each(g.opts.emoticons,function(b,c){a.each(c,function(a,c){g.opts.emoticons[b][a]=g.opts.emoticonsRoot+c})});var b=a.extend({},g.opts.emoticons.more,g.opts.emoticons.dropdown,g.opts.emoticons.hidden),d;a.each(b,function(a,b){d=c.createElement("img"),d.src=b,t.push(d)})},g.createDropDown=function(b,c,d,e){g.closeDropDown(),e!==!1&&a(d).find(":not(input,textarea)").filter(function(){return this.nodeType===1}).attr("unselectable","on");var f={top:b.offset().top,left:b.offset().left,marginTop:b.outerHeight()};a.extend(f,g.opts.dropDownCss),p=a('<div class="sceditor-dropdown sceditor-'+c+'" />').css(f).append(d).appendTo(a("body")).click(function(a){a.stopPropagation()})},J=function(a){a.which!==3&&g.closeDropDown()},A=function(a){function i(a,b){if(a.childNodes.length>0){while(a.firstChild)b.appendChild(a.firstChild);while(h.firstChild)a.appendChild(h.firstChild);B(a,b)}else{if(e>25){while(h.firstChild)a.appendChild(h.firstChild);u.restoreRange();return}++e,setTimeout(function(){i(a,b)},20)}}var b,d=M().body,e=0,f=d.ownerDocument.createElement("div"),h=d.ownerDocument.createDocumentFragment();u.saveRange(),c.body.appendChild(f);if(a&&a.clipboardData&&a.clipboardData.getData)if((b=a.clipboardData.getData("text/html"))||(b=a.clipboardData.getData("text/plain")))return f.innerHTML=b,B(d,f),a.stopPropagation(),a.preventDefault(),!1;while(d.firstChild)h.appendChild(d.firstChild);return i(d,f),g.focus(),!0},B=function(b,c){a.sceditor.dom.fixNesting(c);var d=c.innerHTML;g.opts.getHtmlHandler&&(d=g.opts.getHtmlHandler(d,a(c))),c.parentNode.removeChild(c),g.opts.getTextHandler&&(d=g.opts.getTextHandler(d,!0)),u.restoreRange(),u.insertHTML(d)},g.closeDropDown=function(a){p&&(p.off().remove(),p=null),a===!0&&g.focus()},M=function(){return m.contentDocument?m.contentDocument:m.contentWindow&&m.contentWindow.document?m.contentWindow.document:m.document?m.document:null},g.wysiwygEditorInsertHtml=function(b,c,d){g.focus();if(!d&&(a(u.parentNode()).is("code")||a(u.parentNode()).parents("code").length!==0))return;u.insertHTML(b,c),R()},g.wysiwygEditorInsertText=function(a,b){var c=function(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />"):a};g.wysiwygEditorInsertHtml(c(a),c(b))},g.insertText=function(a,b){return g.inSourceMode()?g.sourceEditorInsertText(a,b):g.wysiwygEditorInsertText(a,b),this},g.sourceEditorInsertText=function(a,b){var d,e,f,g,h;h=o.scrollTop,o.focus(),typeof o.selectionStart!="undefined"?(e=o.selectionStart,f=o.selectionEnd,g=a.length,b&&(a+=o.value.substring(e,f)+b),o.value=o.value.substring(0,e)+a+o.value.substring(f,o.value.length),b?o.selectionStart=e+a.length-b.length:o.selectionStart=e+a.length,o.selectionEnd=o.selectionStart):typeof c.selection.createRange!="undefined"?(d=c.selection.createRange(),b&&(a+=d.text+b),d.text=a,b&&d.moveEnd("character",0-b.length),d.moveStart("character",d.End-d.Start),d.select()):o.value+=a+b,o.scrollTop=h,o.focus()},g.getRangeHelper=function(){return u},g.val=function(a,b){return typeof a=="string"?(g.inSourceMode()?g.setSourceEditorValue(a):(b!==!1&&g.opts.getTextHandler&&(a=g.opts.getTextHandler(a)),g.setWysiwygEditorValue(a)),this):g.inSourceMode()?g.getSourceEditorValue(!1):g.getWysiwygEditorValue()},g.insert=function(b,c,d,e){if(g.inSourceMode())g.sourceEditorInsertText(b,c);else{if(c){var f=g.getRangeHelper().selectedHtml(),h=a("<div>").appendTo(a("body")).hide().html(f);d!==!1&&g.opts.getHtmlHandler&&(f=g.opts.getHtmlHandler(f,h),h.remove()),b+=f+c}d!==!1&&g.opts.getTextHandler&&(b=g.opts.getTextHandler(b,!0)),e!==!1&&(b=x(b)),g.wysiwygEditorInsertHtml(b)}return this},g.getWysiwygEditorValue=function(b){var c=l.contents().find("body"),d;return a.sceditor.ie&&g.focus(),u.saveRange(),a.sceditor.dom.fixNesting(c.get(0)),d=c.html(),b!==!1&&g.opts.getHtmlHandler&&(d=g.opts.getHtmlHandler(d,c)),u.restoreRange(),r=null,d},g.getSourceEditorValue=function(a){var b=n.val();return a!==!1&&g.opts.getTextHandler&&(b=g.opts.getTextHandler(b)),b},g.setWysiwygEditorValue=function(b){b||(b="<p>"+(a.sceditor.ie?"":"<br />")+"</p>"),M().body.innerHTML=x(b),R()},g.setSourceEditorValue=function(a){n.val(a)},g.updateOriginal=function(){i.val(g.val())},x=function(b){if(g.opts.toolbar.indexOf("emoticon")===-1)return b;var c=a.extend({},g.opts.emoticons.more,g.opts.emoticons.dropdown,g.opts.emoticons.hidden);return a.each(c,function(c,d){var f=a.sceditor.regexEscape(c)+"(?=([^\\<\\>]*?<(?!/code)|[^\\<\\>]*?$))",h="";g.opts.emoticonsCompat&&(f="((>|^|\\s| | | | |&nbsp;))"+f+"(?=(\\s|$|<| | | | |&nbsp;))",h="$1"),b=b.replace(new RegExp(f,"gm"),h+e("emoticon",{key:c,url:d}))}),b},g.inSourceMode=function(){return j.hasClass("sourceMode")},g.sourceMode=function(a){return typeof a!="boolean"?g.inSourceMode():((g.inSourceMode()&&!a||!g.inSourceMode()&&a)&&g.toggleSourceMode(),this)},g.toggleSourceMode=function(){if(!a.sceditor.isWysiwygSupported&&g.inSourceMode())return;g.inSourceMode()?g.setWysiwygEditorValue(g.getSourceEditorValue()):g.setSourceEditorValue(g.getWysiwygEditorValue()),r=null,n.toggle(),l.toggle(),g.inSourceMode()?j.removeClass("sourceMode").addClass("wysiwygMode"):j.removeClass("wysiwygMode").addClass("sourceMode"),P()},Q=function(){o.focus();if(o.selectionStart!=null)return o.value.substring(o.selectionStart,o.selectionEnd);if(c.selection.createRange)return c.selection.createRange().text},y=function(b,c){if(g.inSourceMode()){c.txtExec&&(a.isArray(c.txtExec)?g.sourceEditorInsertText.apply(g,c.txtExec):c.txtExec.call(g,b,Q()));return}if(!c.exec)return;a.isFunction(c.exec)?c.exec.call(g,b):g.execCommand(c.exec,c.hasOwnProperty("execParam")?c.execParam:null)},g.focus=function(){return g.inSourceMode()?o.focus():(m.contentWindow.focus(),r&&(u.selectRange(r),r=null)),this},g.blur=function(){return v||(v=a('<input style="width:0; height:0; opacity:0; filter: alpha(opacity=0)" type="text" />').appendTo(j)),v.removeAttr("disabled").focus().blur().attr("disabled","disabled"),this},z=function(){if(!a.sceditor.ie)return;r=u.selectedRange()},g.execCommand=function(b,c){var d=!1,e=a(u.parentNode());g.focus();if(e.is("code")||e.parents("code").length!==0)return;if(M())try{d=M().execCommand(b,!1,c)}catch(f){}!d&&g.commands[b]&&g.commands[b].errorMessage&&alert(g._(g.commands[b].errorMessage))},C=function(b){g.closeDropDown();var c=a(u.parentNode());if(b.which===13)if(c.is("code,blockquote,pre")||c.parents("code,blockquote,pre").length!==0)return r=null,g.wysiwygEditorInsertHtml("<br />",null,!0),!1;if(c.is("code")||c.parents("code").length!==0)return;var d=q.length;while(d--)q[d].call(g,b,m,n)},R=function(){var b,c,d=M();a.sceditor.dom.rTraverse(d.body,function(e){b=e.nodeName.toLowerCase();if(b==="code"||b==="blockquote")c=!0;if(e.nodeType===3&&!/^\s*$/.test(e.nodeValue)||e.nodeName.toLowerCase()==="br"||a.sceditor.ie&&!e.firstChild&&!a.sceditor.dom.isInline(e,!1))return c&&a(d.body).append(a("<div>"+(a.sceditor.ie?"":"<br />")+"</div>\n")),!1})},D=function(){g.val(i.val())},E=function(){g.closeDropDown(),r=null},N=function(){g.opts.height&&g.opts.height.toString().indexOf("%")>-1&&g.height(j.parent().height()*(parseFloat(g.opts.height)/100)),g.opts.width&&g.opts.width.toString().indexOf("%")>-1&&g.width(j.parent().width()*(parseFloat(g.opts.width)/100))},g._=function(){var a=arguments;return s&&s[a[0]]&&(a[0]=s[a[0]]),a[0].replace(/\{(\d+)\}/g,function(b,c){return typeof a[c-0+1]!="undefined"?a[c-0+1]:"{"+c+"}"})},O=function(){if(a.sceditor.locale[g.opts.locale])s=a.sceditor.locale[g.opts.locale];else{var b=g.opts.locale.split("-");a.sceditor.locale[b[0]]&&(s=a.sceditor.locale[b[0]])}s&&s.dateFormat&&(g.opts.dateFormat=s.dateFormat)},w()},a.sceditor.ie=function(){var a,d=3,e=c.createElement("div"),f=e.getElementsByTagName("i");do e.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->";while(f[0]);return c.all&&b.atob&&(d=10),d>4?d:a}(),a.sceditor.isWysiwygSupported=function(){var b=a('<div contenteditable="true">')[0].contentEditable,c=typeof b!="undefined"&&b!=="inherit",d=navigator.userAgent,e;if(!c)return!1;var f=/Opera Mobi|Opera Mini/i.test(d);return/Android/i.test(d)&&(f=!0,/Safari/.test(d)&&(e=/Safari\/(\d+)/.exec(d),f=!e||!e[1]?!0:e[1]<534)),/ Silk\//i.test(d)&&(e=/AppleWebKit\/(\d+)/.exec(d),f=!e||!e[1]?!0:e[1]<534),/iPhone|iPod|iPad/i.test(d)&&(f=!/OS [5-9](_\d)+ like Mac OS X/i.test(d)),/fennec/i.test(d)&&(f=!1),!f}(),a.sceditor.regexEscape=function(a){return a.replace(/[\$\?\[\]\.\*\(\)\|\\]/g,"\\$&").replace("<","&lt;").replace(">","&gt;")},a.sceditor.locale={},a.sceditor.commands={bold:{exec:"bold",tooltip:"Bold"},italic:{exec:"italic",tooltip:"Italic"},underline:{exec:"underline",tooltip:"Underline"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(b,c,d){var f=b.opts.fonts.split(","),g=a("<div />"),h=function(){return d(a(this).data("font")),b.closeDropDown(!0),!1};for(var i=0;i<f.length;i++)g.append(e("fontOpt",{font:f[i]},!0).click(h));b.createDropDown(c,"font-picker",g)},exec:function(b){var c=this;a.sceditor.command.get("font")._dropDown(c,b,function(a){c.execCommand("fontname",a)})},tooltip:"Font Name"},size:{_dropDown:function(b,c,d){var f=a("<div />"),g=function(c){d(a(this).data("size")),b.closeDropDown(!0),c.preventDefault()};for(var h=1;h<=7;h++)f.append(e("sizeOpt",{size:h},!0).click(g));b.createDropDown(c,"fontsize-picker",f)},exec:function(b){var c=this;a.sceditor.command.get("size")._dropDown(c,b,function(a){c.execCommand("fontsize",a)})},tooltip:"Font Size"},color:{_dropDown:function(b,c,d){var e,f,g,h,i={r:255,g:255,b:255},j=a("<div />"),k=b.opts.colors?b.opts.colors.split("|"):new Array(21),l=[],m=a.sceditor.command.get("color");if(!m._htmlCache){for(e=0;e<k.length;++e){h=k[e]?k[e].split(","):new Array(21),l.push('<div class="sceditor-color-column">');for(f=0;f<h.length;++f)g=h[f]||"#"+i.r.toString(16)+i.g.toString(16)+i.b.toString(16),l.push('<a href="#" class="sceditor-color-option" style="background-color: '+g+'" data-color="'+g+'"></a>'),f%5===0?(i.g-=51,i.b=255):i.b-=51;l.push("</div>"),e%5===0?(i.r-=51,i.g=255,i.b=255):(i.g=255,i.b=255)}m._htmlCache=l.join("")}j.append(m._htmlCache).find("a").click(function(c){d(a(this).attr("data-color")),b.closeDropDown(!0),c.preventDefault()}),b.createDropDown(c,"color-picker",j)},exec:function(b){var c=this;a.sceditor.command.get("color")._dropDown(c,b,function(a){c.execCommand("forecolor",a)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(a){var b,c=this,d=e("pastetext",{label:c._("Paste your text inside the following box:"),insert:c._("Insert")},!0);d.find(".button").click(function(a){b=d.find("#txt").val(),b&&c.wysiwygEditorInsertText(b),c.closeDropDown(!0),a.preventDefault()}),c.createDropDown(a,"pastetext",d)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},table:{exec:function(b){var c=this,d=e("table",{rows:c._("Rows:"),cols:c._("Cols:"),insert:c._("Insert")},!0);d.find(".button").click(function(b){var e=d.find("#rows").val()-0,f=d.find("#cols").val()-0,g="<table>";if(e<1||f<1)return;for(var h=0;h<e;h++){g+="<tr>";for(var i=0;i<f;i++)g+="<td>"+(a.sceditor.ie?"":"<br />")+"</td>";g+="</tr>"}g+="</table>",c.wysiwygEditorInsertHtml(g),c.closeDropDown(!0),b.preventDefault()}),c.createDropDown(b,"inserttable",d)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(a){var b=this,c=e("image",{url:b._("URL:"),width:b._("Width (optional):"),height:b._("Height (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#image").val(),e=c.find("#width").val(),f=c.find("#height").val(),g="";e&&(g+=' width="'+e+'"'),f&&(g+=' height="'+f+'"'),d&&d!=="http://"&&b.wysiwygEditorInsertHtml("<img"+g+' src="'+d+'" />'),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertimage",c)},tooltip:"Insert an image"},email:{exec:function(a){var b=this,c=e("email",{label:b._("E-mail:"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#email").val();d&&(b.focus(),b.getRangeHelper().selectedHtml()?b.execCommand("createlink","mailto:"+d):b.wysiwygEditorInsertHtml('<a href="mailto:'+d+'">'+d+"</a>")),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertemail",c)},tooltip:"Insert an email"},link:{exec:function(a){var b=this,c=e("link",{url:b._("URL:"),desc:b._("Description (optional):"),ins:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#link").val(),e=c.find("#des").val();d&&d!=="http://"&&(b.focus(),!b.getRangeHelper().selectedHtml()||e?(e||(e=d),b.wysiwygEditorInsertHtml('<a href="'+d+'">'+e+"</a>")):b.execCommand("createlink",d)),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertlink",c)},tooltip:"Insert a link"},unlink:{exec:"unlink",tooltip:"Unlink"},quote:{exec:function(a,b,c){var d="<blockquote>",e="</blockquote>";b?(c=c?"<cite>"+c+"</cite>":"",d=d+c+b+e+"<br />",e=null):this.getRangeHelper().selectedHtml()===""&&(e="<br />"+e),this.wysiwygEditorInsertHtml(d,e)},tooltip:"Insert a Quote"},emoticon:{exec:function(b){var c,d=this,e=d.opts.emoticonsCompat?" ":"",f=a("<div />"),g=a("<div />");c=function(b,c){g.append(a("<img />").attr({src:c,alt:b}).click(function(b){d.insert(a(this).attr("alt")+e),d.closeDropDown(!0),b.preventDefault()})),g.children().length>3&&(f.append(g),g=a("<div />"))},a.each(d.opts.emoticons.dropdown,c),g.children().length>0&&f.append(g);if(d.opts.emoticons.more){var h=a(this._('<a class="sceditor-more">{0}</a>',this._("More"))).click(function(){var e=a.extend({},d.opts.emoticons.dropdown,d.opts.emoticons.more);return f=a("<div />"),a.each(e,c),g.children().length>0&&f.append(g),d.createDropDown(b,"insertemoticon",f),!1});f.append(h)}d.createDropDown(b,"insertemoticon",f)},txtExec:function(b){a.sceditor.command.get("emoticon").exec.call(this,b)},keyPress:function(b){if(this.opts.toolbar.indexOf("emoticon")===-1)return;var c=this,d=0,f=String.fromCharCode(b.which);c.EmoticonsCache||(c.EmoticonsCache=[],a.each(a.extend({},c.opts.emoticons.more,c.opts.emoticons.dropdown,c.opts.emoticons.hidden),function(a,b){c.EmoticonsCache[d++]=[a,e("emoticon",{key:a,url:b})]}),c.EmoticonsCache.sort(function(a,b){return a[0].length-b[0].length})),c.longestEmoticonCode||(c.longestEmoticonCode=c.EmoticonsCache[c.EmoticonsCache.length-1][0].length);if(c.getRangeHelper().raplaceKeyword(c.EmoticonsCache,!0,!0,c.longestEmoticonCode,c.opts.emoticonsCompat,f))return/^\s$/.test(f)&&c.opts.emoticonsCompat?!0:(b.preventDefault(),b.stopPropagation(),!1)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(a,b,c){var d,f=e("youtubeMenu",{label:a._("Video URL:"),insert:a._("Insert")},!0);f.find(".button").click(function(b){var e=f.find("#link").val().replace("http://","");e!==""&&(d=e.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),d&&(e=d[1]),/^[a-zA-Z0-9_\-]{11}$/.test(e)?c(e):alert("Invalid YouTube video")),a.closeDropDown(!0),b.preventDefault()}),a.createDropDown(b,"insertlink",f)},exec:function(b){var c=this;a.sceditor.command.get("youtube")._dropDown(c,b,function(a){c.wysiwygEditorInsertHtml(e("youtube",{id:a}))})},tooltip:"Insert a YouTube video"},date:{_date:function(a){var b=new Date,c=b.getYear(),d=b.getMonth()+1,e=b.getDate();return c<2e3&&(c=1900+c),d<10&&(d="0"+d),e<10&&(e="0"+e),a.opts.dateFormat.replace(/year/i,c).replace(/month/i,d).replace(/day/i,e)},exec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds();return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b+":"+c+":"+d},exec:function(){this.insertText(a.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(a.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus();if(!c||d.is("body")){b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c);if(!c||d.is("body"))return}d.css("direction")==="ltr"?a(c).css("direction",""):a(c).attr("direction","ltr")},tooltip:"Left-to-Right"},rtl:{exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus();if(!c||d.is("body")){b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c);if(!c||d.is("body"))return}d.css("direction")==="rtl"?a(c).css("direction",""):a(c).css("direction","rtl")},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},source:{exec:function(){this.toggleSourceMode(),this.blur()},txtExec:function(){this.toggleSourceMode(),this.blur()},tooltip:"View source"},ignore:{}},a.sceditor.rangeHelper=function(b,c){var d,e,f,g,h,i,j=!0,k="sceditor-start-marker",l="sceditor-end-marker",m="character",n=this;f=function(a,b){e=b||a.contentDocument||a.document,d=a,j=!!a.getSelection}(b,c),n.insertHTML=function(a,b){var c,d,f=n.selectedRange();b&&(a+=n.selectedHtml()+b);if(j){d=e.createElement("div"),c=e.createDocumentFragment(),d.innerHTML=a;while(d.firstChild)c.appendChild(d.firstChild);n.insertNode(c)}else{if(!f)return!1;f.pasteHTML(a)}},n.insertNode=function(a,b){if(j){var c,d,f=e.createDocumentFragment(),g=n.selectedRange();if(!g)return!1;f.appendChild(a),b&&(f.appendChild(g.extractContents()),f.appendChild(b)),d=f.lastChild,g.deleteContents(),g.insertNode(f),c=e.createRange(),c.setStartAfter(d),n.selectRange(c)}else n.insertHTML(a.outerHTML,b?b.outerHTML:null)},n.cloneSelected=function(){var a=n.selectedRange();if(a)return j?a.cloneRange():a.duplicate()},n.selectedRange=function(){var a,b=j?d.getSelection():e.selection;if(!b)return;return b.getRangeAt&&b.rangeCount<=0&&(a=e.createRange(),a.setStart(e.body,0),b.addRange(a)),j?b.getRangeAt(0):b.createRange()},n.selectedHtml=function(){var a,b=n.selectedRange();return b?!j&&b.text!==""&&b.htmlText?b.htmlText:j?(a=e.createElement("div"),a.appendChild(b.cloneContents()),a.innerHTML):"":""},n.parentNode=function(){var a=n.selectedRange();if(a)return j?a.commonAncestorContainer:a.parentElement()},n.getFirstBlockParent=function(){var b=function(c){if(!a.sceditor.dom.isInline(c))return c;var d=c.parentNode;return d?b(d):null};return b(n.parentNode())},n.insertNodeAt=function(a,b){var c=n.cloneSelected();if(!c)return!1;c.collapse(a),c.insertNode?c.insertNode(b):c.pasteHTML(b.outerHTML)},g=function(a){n.removeMarker(a);var b=e.createElement("span");return b.id=a,b.style.lineHeight="0",b.style.display="none",b.className="sceditor-selection",b},n.insertMarkers=function(){n.insertNodeAt(!0,g(k)),n.insertNodeAt(!1,g(l))},n.getMarker=function(a){return e.getElementById(a)},n.removeMarker=function(a){var b=n.getMarker(a);b&&b.parentNode.removeChild(b)},n.removeMarkers=function(){n.removeMarker(k),n.removeMarker(l)},n.saveRange=function(){n.insertMarkers()},n.selectRange=function(a){j?(d.getSelection().removeAllRanges(),d.getSelection().addRange(a)):a.select()},n.restoreRange=function(){var a,b=n.selectedRange(),c=n.getMarker(k),d=n.getMarker(l);if(!c||!d||!b)return!1;j?(b=e.createRange(),b.setStartBefore(c),b.setEndAfter(d),n.selectRange(b)):(b=e.body.createTextRange(),a=e.body.createTextRange(),a.moveToElementText(c),b.setEndPoint("StartToStart",a),b.moveStart(m,0),a.moveToElementText(d),b.setEndPoint("EndToStart",a),b.moveEnd(m,0),n.selectRange(b)),n.removeMarkers()},i=function(a,b){var c=n.cloneSelected();if(!c)return!1;c.collapse(!1),j?(c.setStart(c.startContainer,c.startOffset-a),c.setEnd(c.endContainer,c.endOffset+b)):(c.moveStart(m,0-a),c.moveEnd(m,b)),n.selectRange(c)},h=function(a,b){var c="",d=n.cloneSelected();return d?(d.collapse(!1),a?j?(c=d.startContainer.textContent.substr(0,d.startOffset),c=c.substr(Math.max(0,c.length-b))):(d.moveStart(m,0-b),c=d.text):j?c=d.startContainer.textContent.substr(d.startOffset,b):(d.moveEnd(m,b),c=d.text),c):""},n.raplaceKeyword=function(b,c,d,e,f,g){d||b.sort(function(a,b){return a.length-b.length});var k,l,m,o,p,q,r,s,t=e||b[b.length-1][0].length;k=l=m="";if(f){if(!j)return!1;++t}k=h(!0,t),c&&(l=h(!1,t)),m=k+(g!=null?g:"")+l,o=b.length;while(o--){r=new RegExp("(?:[\\s    ])"+a.sceditor.regexEscape(b[o][0])+"(?=[\\s    ])"),s=k.length-1-b[o][0].length,f&&--s,s=Math.max(0,s);if(!f&&(p=m.indexOf(b[o][0],s))>-1||f&&(p=m.substr(s).search(r))>-1){f&&(p+=s+1);if(p>k.length||p+b[o][0].length+(f?1:0)<k.length)continue;return q=k.length-p,i(q,b[o][0].length-q-(g!=null&&/^\S/.test(g)?1:0)),n.insertHTML(b[o][1]),!0}}return!1}},a.sceditor.dom={traverse:function(a,b,c,d,e){if(a){a=e?a.lastChild:a.firstChild;while(a!=null){var f=e?a.previousSibling:a.nextSibling;if(!c&&b(a)===!1)return!1;if(!d&&this.traverse(a,b,c,d,e)===!1)return!1;if(c&&b(a)===!1)return!1;a=f}}},rTraverse:function(a,b,c,d){this.traverse(a,b,c,d,!0)},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",isInline:function(b,c){return!b||b.nodeType!==1?!0:(b=b.tagName.toLowerCase(),b==="code"?!c:a.sceditor.dom.blockLevelList.indexOf("|"+b+"|")<0)},copyCSS:function(a,b){b.style.cssText=a.style.cssText+b.style.cssText},fixNesting:function(a){var b=this,c=function(a){while(b.isInline(a.parentNode,!0))a=a.parentNode;return a};b.traverse(a,function(a){if(a.nodeType===1&&!b.isInline(a,!0)&&b.isInline(a.parentNode,!0)){var d=c(a),e=d.parentNode,f=b.extractContents(d,a),g=a;b.copyCSS(d,g),e.insertBefore(f,d),e.insertBefore(g,d)}})},findCommonAncestor:function(b,c){return a(b).parents().has(a(c)).first()},removeWhiteSpace:function(b){var c,d=/[^\S|\u00A0]+/g;this.traverse(b,function(b){c=b.nodeValue;if(b.nodeType===3&&a(b).parents("code, pre").length===0&&c){c=c.replace(/[\r\n]/,"");if(!c.length){b.parentNode.removeChild(b);return}/\S|\u00A0/.test(c)?d.test(c)&&(b.nodeValue=c.replace(d," ")):b.nodeValue=" "}})},extractContents:function(a,b){var c=this,d=c.findCommonAncestor(a,b),e=d?d.get(0):null,f=!1,g=!1;return function h(d){var e=a.ownerDocument.createDocumentFragment();return c.traverse(d,function(c){if(g||c===b&&f)return g=!0,!1;c===a&&(f=!0);var d,i;f?jQuery.contains(c,b)&&c.nodeType===1?(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i)):e.appendChild(c):jQuery.contains(c,a)&&c.nodeType===1&&(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i))},!1),e}(e)}},a.sceditor.command={get:function(b){return a.sceditor.commands[b]||null},set:function(b,c){return!b||!c?!1:(c=a.extend(a.sceditor.commands[b]||{},c),c.remove=function(){a.sceditor.command.remove(b)},a.sceditor.commands[b]=c,this)},remove:function(b){return a.sceditor.commands[b]&&delete a.sceditor.commands[b],this}},a.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,source",style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:"en",charset:"utf-8",emoticonsCompat:!1,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png"
,":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,readOnly:!1,rtl:!1,autofocus:!1,autoExpand:!1,autoUpdate:!1,runWithoutWysiwygSupport:!1,id:null,plugins:"",parserOptions:{},dropDownCss:{}},a.fn.sceditor=function(b){var c,d=[];b=b||{};if(!b.runWithoutWysiwygSupport&&!a.sceditor.isWysiwygSupported)return;return this.each(function(){c=this.jquery?this:a(this);if(c.parents(".sceditor-container").length>0)return;b==="state"?d.push(!!c.data("sceditor")):b==="instance"?d.push(c.data("sceditor")):c.data("sceditor")||(b.plugins&&/bbcode/i.test(b.plugins)?new a.sceditorBBCodePlugin(c,b):new a.sceditor(this,b))}),d.length?d.length===1?d[0]:a(d):this}})(jQuery,window,document),function(a,b,c){"use strict",a.sceditor.BBCodeParser=function(b){if(!(this instanceof a.sceditor.BBCodeParser))return new a.sceditor.BBCodeParser(b);var d=this,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s={open:"open",content:"content",newline:"newline",close:"close"};Object.freeze&&Object.freeze(s);var t=function(a,b,c,d,e,f){var g=this;g.type=a,g.name=b,g.val=c,g.attrs=d||{},g.children=e||[],g.closing=f||null};t.prototype={clone:function(a){var b=this;return new t(b.type,b.name,b.val,b.attrs,a?b.children:[],b.closing?b.closing.clone():null)},splitAt:function(b){var c,d=this,e=0,f=d.children.length;typeof object!="number"&&(b=a.inArray(b,d.children));if(b<0||b>f)return null;while(f--)f>=b?e++:f=!1;return c=d.clone(),c.children=d.children.splice(b,e),c}},e=function(){d.opts=a.extend({},a.sceditor.BBCodeParser.defaults,b),d.bbcodes=a.sceditorBBCodePlugin.bbcodes},d.tokenize=function(a){var b,c,d,e=[],g=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];g.reverse();a:while(a.length){d=g.length;while(d--){c=g[d].type;if(!(b=a.match(g[d].regex))||!b[0])continue;e.push(f(c,b[0])),a=a.substr(b[0].length);continue a}a.length&&e.push(f(s.content,a)),a=""}return e},f=function(b,c){var d,e,f;return b==="open"?(d=c.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/),f=q(d[1]),d[2]&&(d[2]=a.trim(d[2]))&&(e=g(d[2]))):b==="close"?(d=c.match(/\[\/([^\[\]]+)\]/),f=q(d[1])):b==="newline"?f="#newline":f="#",new t(b,f,c,e)},g=function(b){var c,d=/(\S+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|([^'"\s]+))/g,e={};if(b.charAt(0)==="="&&b.split("=").length<=2)e.defaultattr=a.sceditorBBCodePlugin.stripQuotes(b.substr(1));else{b.charAt(0)==="="&&(b="defaultattr"+b);while(c=d.exec(b))e[q(c[1])]=c[3]||c[4]}return e},d.parse=function(a,b){var c=h(d.tokenize(a));return d.opts.fixInvalidChildren&&m(c),d.opts.removeEmptyTags&&l(c),d.opts.fixInvalidNesting&&j(c),i(c,null,b),d.opts.removeEmptyTags&&l(c),c},p=function(a,b,c){var d=c.length;while(d--)if(c[d].type===b&&c[d].name===a)return!0;return!1},k=function(b,c){var e=b?d.bbcodes[b.name]:null,f=e?e.allowedChildren:null;return!d.opts.fixInvalidChildren||!f?!0:f&&a.inArray(c.name||"#",f)<0?!1:!0},h=function(b){var c,e,f,g,h,i,j,k=[],l=[],m=[],n=function(){return r(m)},o=function(a){n()?n().children.push(a):l.push(a)},q=function(b){return n()&&(e=d.bbcodes[n().name])&&e.closedBy&&a.inArray(b,e.closedBy)>-1};while(c=b.shift()){j=b[0];switch(c.type){case s.open:q(c.name)&&m.pop(),o(c),e=d.bbcodes[c.name],(!e||!e.isSelfClosing)&&(e||p(c.name,s.close,b))&&m.push(c);break;case s.close:n()&&c.name!==n().name&&q(c.name)&&m.pop();if(n()&&c.name===n().name)n().closing=c,m.pop();else if(p(c.name,s.open,m)){while(f=m.pop()){if(f.name===c.name){f.closing=c;break}g=f.clone(),k.length>1&&g.children.push(r(k)),k.push(g)}o(r(k)),h=k.length;while(h--)m.push(k[h]);k.length=0}else c.type=s.content,o(c);break;case s.newline:n()&&j&&q(j.name)&&(j.type!==s.close||j.name!==n().name)&&(e=d.bbcodes[n().name],e&&e.breakAfter?m.pop():e&&e.isInline===!1&&d.opts.breakAfterBlock&&e.breakAfter!==!1&&m.pop()),o(c);break;default:o(c)}i=c}return l},i=function(a,b,c){var e,f,g,h,j,k,l,m,n,o=a.length,p=o;b&&(h=d.bbcodes[b.name]);while(p--){if(!(e=a[p]))continue;if(e.type===s.newline){f=p>0?a[p-1]:null,g=p<o-1?a[p+1]:null,n=!1,!c&&h&&h.isSelfClosing!==!0&&(p===0?(h.isInline===!1&&d.opts.breakStartBlock&&h.breakStart!==!1&&(n=!0),h.breakStart&&(n=!0)):!l&&o-1===p&&(h.isInline===!1&&d.opts.breakEndBlock&&h.breakEnd!==!1&&(n=!0),h.breakEnd&&(n=!0),l=n)),f&&f.type===s.open&&(j=d.bbcodes[f.name])&&(c?j.isInline===!1&&(n=!0):(j.isInline===!1&&d.opts.breakAfterBlock&&j.breakAfter!==!1&&(n=!0),j.breakAfter&&(n=!0)));if(!c&&!m&&g&&g.type===s.open)if(k=d.bbcodes[g.name]){k.isInline===!1&&d.opts.breakBeforeBlock&&k.breakBefore!==!1&&(n=!0),k.breakBefore&&(n=!0),m=n;if(n){a.splice(p,1);continue}}n&&a.splice(p,1),m=!1}else e.type===s.open&&i(e.children,e,c)}},j=function(b,c,e,f){var g,h,i,k,l,m,n=function(a){var b=d.bbcodes[a.name];return!b||b.isInline!==!1};c=c||[],f=f||b;for(h=0;h<b.length;h++){if(!(g=b[h])||g.type!==s.open)continue;if(!n(g)&&e){i=r(c),m=i.splitAt(g),l=c.length>1?c[c.length-2].children:f;if((k=a.inArray(i,l))>-1){m.children.splice(a.inArray(g,m.children),1),l.splice(k+1,0,g,m);return}}c.push(g),j(g.children,c,e||n(g),f),c.pop(g)}},m=function(a,b){var c,d,e=a.length;while(e--){if(!(c=a[e]))continue;k(b,c)||(c.name=null,c.type=s.content,k(b,c)?(d=[e+1,0].concat(c.children),c.closing&&(c.closing.name=null,c.closing.type=s.content,d.push(c.closing)),e+=d.length-1,Array.prototype.splice.apply(a,d)):b.children.splice(e,1)),c.type===s.open&&m(c.children,c)}},l=function(a){var b,c,e=a.length;while(e--){if(!(b=a[e])||b.type!==s.open)continue;c=d.bbcodes[b.name],l(b.children),b.children.length<1&&c&&!c.isSelfClosing&&!c.allowsEmpty&&a.splice(e,1)}},d.toHTML=function(a,b){return n(d.parse(a,b),!0)},n=function(b,e){var f,g,h,i,j,k,l,m,o=[];while(b.length>0){if(!(f=b.shift()))continue;if(f.type===s.open)g=d.bbcodes[f.name],l=!g||(typeof g.isHtmlInline!="undefined"?g.isHtmlInline:g.isInline),j=e&&(!g||l!==!1),h=n(f.children,!1),g&&g.html?(m=l===!1&&!g.isPreFormatted&&!g.skipLastLineBreak,m&&!a.sceditor.ie&&(h+="<br />"),a.isFunction(g.html)?i=g.html.call(d,f,f.attrs,h):i=a.sceditorBBCodePlugin.formatString(g.html,h)):i=f.val+h+(f.closing?f.closing.val:"");else{if(f.type===s.newline){if(!e){o.push("<br />");continue}if(k){o.push("</div>\n"),k=!1;continue}o.push("<div>"),a.sceditor.ie||o.push("<br />"),(c.documentMode&&c.documentMode<8||a.sceditor.ie<8)&&o.push(" "),o.push("</div>\n");continue}j=e,i=f.val.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}j&&!k?(o.push("<div>"),k=!0):!j&&k&&(o.push("</div>\n"),k=!1),o.push(i)}return k&&o.push("</div>\n"),o.join("")},d.toBBCode=function(a,b){return o(d.parse(a,b))},o=function(a){var b,c,e,f,g,h,i,j,k,l=[];while(a.length>0){if(!(b=a.shift()))continue;e=d.bbcodes[b.name],f=!!e&&e.isInline===!1,g=e&&e.isSelfClosing,h=f&&d.opts.breakBeforeBlock&&e.breakBefore!==!1||e&&e.breakBefore,i=f&&!g&&d.opts.breakStartBlock&&e.breakStart!==!1||e&&e.breakStart,j=f&&d.opts.breakEndBlock&&e.breakEnd!==!1||e&&e.breakEnd,k=f&&d.opts.breakAfterBlock&&e.breakAfter!==!1||e&&e.breakAfter;if(!e&&b.type===s.open)l.push(b.val),b.children&&l.push(o(b.children)),b.closing&&l.push(b.closing.val);else if(b.type===s.open){h&&l.push("\n"),l.push("["+b.name);if(b.attrs){b.attrs.defaultattr&&(l.push("="+b.attrs.defaultattr),delete b.attrs.defaultattr);for(c in b.attrs)b.attrs.hasOwnProperty(c)&&l.push(" "+c+'="'+b.attrs[c]+'"')}l.push("]"),i&&l.push("\n"),b.children&&l.push(o(b.children)),!g&&!e.excludeClosing&&(j&&l.push("\n"),l.push("[/"+b.name+"]")),k&&l.push("\n"),b.closing&&g&&l.push(b.closing.val)}else l.push(b.val)}return l.join("")},r=function(a){return a.length?a[a.length-1]:null},q=function(a){return a.toLowerCase()},e()},a.sceditor.BBCodeParser.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0},a.sceditorBBCodePlugin=function(b,d){var e=this,f,g,h,i,j,k,l,m,n;j=a.sceditorBBCodePlugin.formatString,e.bbcodes=a.sceditorBBCodePlugin.bbcodes,e.stripQuotes=a.sceditorBBCodePlugin.stripQuotes;var o={},p={},q={ul:["li"],ol:["li"],table:["tr"],tr:["td","th"],code:["br","p","div"]},r={};f=function(){b.data("sceditorbbcode",e),e.opts=a.extend({},a.sceditor.defaultOptions,d),g(),new a.sceditor(b,a.extend({},e.opts,{getHtmlHandler:e.getHtmlHandler,getTextHandler:e.getTextHandler,commands:m()}))},m=function(){var b={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(b){var c=this;a.sceditor.command.get("font")._dropDown(c,b,function(a){c.insertText("[font="+a+"]","[/font]")})}},size:{txtExec:function(b){var c=this;a.sceditor.command.get("size")._dropDown(c,b,function(a){c.insertText("[size="+a+"]","[/size]")})}},color:{txtExec:function(b){var c=this;a.sceditor.command.get("color")._dropDown(c,b,function(a){c.insertText("[color="+a+"]","[/color]")})}},bulletlist:{txtExec:["[ul][li]","[/li][/ul]"]},orderedlist:{txtExec:["[ol][li]","[/li][/ol]"]},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(a,b){var c=prompt(this._("Enter the image URL:"),b);c&&this.insertText("[img]"+c+"[/img]")}},email:{txtExec:function(a,b){var c=b&&b.indexOf("@")>-1?null:b,d=prompt(this._("Enter the e-mail address:"),c?"":b),e=prompt(this._("Enter the displayed text:"),c||d)||d;d&&this.insertText("[email="+d+"]"+e+"[/email]")}},link:{txtExec:function(a,b){var c=b&&b.indexOf("http://")>-1?null:b,d=prompt(this._("Enter URL:"),c?"http://":b),e=prompt(this._("Enter the displayed text:"),c||d)||d;d&&this.insertText("[url="+d+"]"+e+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(b){var c=this;a.sceditor.command.get("youtube")._dropDown(c,b,function(a){c.insertText("[youtube]"+a+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};return a.extend(!0,{},b,a.sceditor.commands)},g=function(){a.each(e.bbcodes,function(b){typeof e.bbcodes[b].tags!="undefined"&&a.each(e.bbcodes[b].tags,function(a,c){var d=e.bbcodes[b].isInline===!1;o[a]=o[a]||{},o[a][d]=o[a][d]||{},o[a][d][b]=c}),typeof e.bbcodes[b].styles!="undefined"&&a.each(e.bbcodes[b].styles,function(a,c){var d=e.bbcodes[b].isInline===!1;p[d]=p[d]||{},p[d][a]=p[d][a]||{},p[d][a][b]=c})})},k=function(b,c){var d,e,f,g,h,i=b.style;return i?(r[c]||(r[c]=a.camelCase(c)),h=r[c],"text-align"===c?(d=a(b),f=i.direction,g=i[h]||d.css(c),d.parent().css(c)!==g&&d.css("display")==="block"&&!d.is("hr")&&!d.is("th")&&(e=g),f&&e&&(/right/i.test(e)&&f==="rtl"||/left/i.test(e)&&f==="ltr")?null:e):i[h]):null},l=function(a){var b=a.childNodes,c=b.length;if(a.nodeValue&&/\S|\u00A0/.test(a.nodeValue))return!1;if(b.length===0||b.length===1&&(/br/i.test(b[0].nodeName)||l(b[0])))return!0;while(c--)if(!l(b[c]))return!1;return!0},h=function(b,c,d){var f;return d=!!d,p[d]?(a.each(p[d],function(d,g){f=k(b[0],d);if(!f||k(b.parent()[0],d)===f)return;a.each(g,function(d,g){if(!/\S|\u00A0/.test(c)&&!e.bbcodes[d].allowsEmpty&&l(b[0]))return;if(!g||a.inArray(f.toString(),g)>-1)a.isFunction(e.bbcodes[d].format)?c=e.bbcodes[d].format.call(e,b,c):c=j(e.bbcodes[d].format,c)})}),c):c},i=function(b,c,d){var f=b[0].nodeName.toLowerCase();d=!!d,o[f]&&o[f][d]&&a.each(o[f][d],function(d,f){if(!/\S|\u00A0/.test(c)&&!e.bbcodes[d].allowsEmpty&&l(b[0]))return;if(f){var g=!1;a.each(f,function(c,d){if(!b.attr(c)||d&&a.inArray(b.attr(c),d)<0)return;return g=!0,!1});if(!g)return}a.isFunction(e.bbcodes[d].format)?c=e.bbcodes[d].format.call(e,b,c):c=j(e.bbcodes[d].format,c)});if(d&&(!a.sceditor.dom.isInline(b[0],!0)||f==="br")){var g=b[0].parentNode,h=b[0].previousSibling,i=a.sceditor.dom.isInline(g,!0)||g.nodeName.toLowerCase()==="body";if(i||f==="li"||g.lastChild!==b[0]||f==="br"&&a.sceditor.ie)c+="\n";"br"!==f&&!i&&h&&h.nodeType===3&&(c="\n"+c)}return c},e.getHtmlHandler=function(b,c){var d=new a.sceditor.BBCodeParser(e.opts.parserOptions);return a.sceditor.dom.removeWhiteSpace(c[0]),a.trim(d.toBBCode(e.elementToBbcode(c),!0))},e.elementToBbcode=function(b){return function c(b,d){var e="";return a.sceditor.dom.traverse(b,function(b){var f=a(b),g="",j=b.nodeName.toLowerCase(),k=q[j],l=!0;typeof d=="object"&&(l=a.inArray(j,d)>-1,l||(k=d));if(b.nodeType!==3){if(f.hasClass("sceditor-ignore"))return;j!=="iframe"&&(g=c(b,k)),l?(j!=="code"&&(g=h(f,g),g=i(f,g),g=h(f,g,!0)),e+=i(f,g,!0)):e+=g}else b.wholeText&&(!b.previousSibling||b.previousSibling.nodeType!==3)?f.parents("code").length===0?e+=b.wholeText.replace(/ +/g," "):e+=b.wholeText:b.wholeText||(e+=b.nodeValue)},!1,!0),e}(b.get(0))},e.getTextHandler=function(b,c){var d=new a.sceditor.BBCodeParser(e.opts.parserOptions),f=d.toHTML(b);return c?n(f):f},n=function(b){var d,e,f,g=a("<div />").hide().appendTo(c.body),h=g[0];h.innerHTML=b,d=h.firstChild;if(d&&d.nodeName.toLowerCase()==="div"){while(e=d.firstChild)h.insertBefore(e,d);a.sceditor.ie>=9&&h.insertBefore(c.createElement("br"),d),h.removeChild(d)}d=h.lastChild;if(d&&d.nodeName.toLowerCase()==="div"){while(e=d.firstChild)h.insertBefore(e,d);a.sceditor.ie>=9&&h.insertBefore(c.createElement("br"),d),h.removeChild(d)}return f=h.innerHTML,g.remove(),f},f()},a.sceditorBBCodePlugin.stripQuotes=function(a){return a.replace(/^(["'])(.*?)\1$/,"$2")},a.sceditorBBCodePlugin.formatString=function(){var a=arguments;return a[0].replace(/\{(\d+)\}/g,function(b,c){return typeof a[c-0+1]!="undefined"?a[c-0+1]:"{"+c+"}"})},a.sceditorBBCodePlugin.normaliseColour=function(a){function c(a){return a=parseInt(a,10),isNaN(a)?"00":(a=Math.max(0,Math.min(a,255)).toString(16),a.length<2?"0"+a:a)}var b;return(b=a.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+c(b[1])+c(b[2]-0)+c(b[3]-0):(b=a.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]:a},a.sceditorBBCodePlugin.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},format:function(a,b){var c;if(a[0].nodeName.toLowerCase()!=="font"||!(c=a.attr("face")))c=a.css("font-family");return"[font="+this.stripQuotes(c)+"]"+b+"[/font]"},html:function(a,b,c){return'<font face="'+b.defaultattr+'">'+c+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(a,b){var c=a.attr("size"),d=1;return c||(c=a.css("fontSize")),c.indexOf("px")>-1?(c=c.replace("px","")-0,c>12&&(d=2),c>15&&(d=3),c>17&&(d=4),c>23&&(d=5),c>31&&(d=6),c>47&&(d=7)):d=c,"[size="+d+"]"+b+"[/size]"},html:function(a,b,c){return'<font size="'+b.defaultattr+'">'+c+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},format:function(b,c){var d,e=b[0];if(e.nodeName.toLowerCase()!=="font"||!(d=b.attr("color")))d=e.style.color||b.css("color");return"[color="+a.sceditorBBCodePlugin.normaliseColour(d)+"]"+c+"[/color]"},html:function(a,b,c){return'<font color="'+b.defaultattr+'">'+c+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["ul","ol","list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["ul","ol","list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(a,b){return a.attr("data-sceditor-emoticon")+b},html:"{0}"},horizontalrule:{allowsEmpty:!0,tags:{hr:null},format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},format:function(b,c){var d="",e=function(a){return b.style?b.style[a]:null};if(typeof b.attr("data-sceditor-emoticon")!="undefined")return c;if(b.attr("width")||b.attr("height")||e("width")||e("height"))d="="+a(b).width()+"x"+a(b).height();return"[img"+d+"]"+b.attr("src")+"[/img]"},html:function(a,b,c){var d,e="";return typeof b.width!="undefined"&&(e+=' width="'+b.width+'"'),typeof b.height!="undefined"&&(e+=' height="'+b.height+'"'),typeof b.defaultattr!="undefined"&&(d=b.defaultattr.split(/x/i),e=' width="'+d[0]+'"'+' height="'+(d.length===2?d[1]:d[0])+'"'),"<img"+e+' src="'+c+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},format:function(a,b){var c=a.attr("href");return c.substr(0,7)==="mailto:"?"[email="+c.substr(7)+"]"+b+"[/email]":"[url="+decodeURI(c)+"]"+b+"[/url]"},html:function(a,b,c){if(typeof b.defaultattr=="undefined"||b.defaultattr.length===0)b.defaultattr=c;return'<a href="'+encodeURI(b.defaultattr)+'">'+c+"</a>"}},email:{html:function(a,b,c){return typeof b.defaultattr=="undefined"&&(b.defaultattr=c),'<a href="mailto:'+b.defaultattr+'">'+c+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,format:function(b,c){var d="",e=a(b),f=e.children("cite").first();if(f.length===1||e.data("author"))d=f.text()||e.data("author"),e.data("author",d),f.remove(),e.children("cite").replaceWith(function(){return a(this).text()}),c=this.elementToBbcode(a(b)),d="="+d;return"[quote"+d+"]"+c+"[/quote]"},html:function(a,b,c){return typeof b.defaultattr!="undefined"&&(c="<cite>"+b.defaultattr+"</cite>"+c),"<blockquote>"+c+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(a,b){return(a=a.attr("data-youtube-id"))?"[youtube]"+a+"[/youtube]":b},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},hr:{tags:{hr:null},isSelfClosing:!0,isInline:!1,format:"[hr]",html:"<hr />"},ignore:{}},a.sceditorBBCodePlugin.bbcode={get:function(b){return a.sceditorBBCodePlugin.bbcodes[b]||null},set:function(b,c){return!b||!c?!1:(c=a.extend(a.sceditorBBCodePlugin.bbcodes[b]||{},c),c.remove=function(){a.sceditorBBCodePlugin.bbcode.remove(b)},a.sceditorBBCodePlugin.bbcodes[b]=c,this)},rename:function(a,b){return this.hasOwnProperty(a)?(this[b]=this[a],this.remove(a),this):!1},remove:function(b){return a.sceditorBBCodePlugin.bbcodes[b]&&delete a.sceditorBBCodePlugin.bbcodes[b],this}},a.fn.sceditorBBCodePlugin=function(b){var c,d=[];b=b||{};if(!b.runWithoutWysiwygSupport&&!a.sceditor.isWysiwygSupported)return;return this.each(function(){c=this.jquery?this:a(this);if(c.parents(".sceditor-container").length>0)return;b==="state"?d.push(!!c.data("sceditor")):b==="instance"?d.push(c.data("sceditorbbcode")):c.data("sceditor")||new a.sceditorBBCodePlugin(c,b)}),d.length?d.length===1?d[0]:a(d):this}}(jQuery,window,document);