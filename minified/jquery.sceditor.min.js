(function(a){a.sceditor=function(c,b){var d=this;d.$textarea=a(c);d.textarea=c;d.editorContainer=null;d.$toolbar=null;d.$wysiwygEditor=null;d.wysiwygEditor=null;d.$textEeditor=null;d.$dropdown=null;d.dropdownIgnoreLastClick=false;d.keyPressFuncs=[];d.lastRange=null;d.preLoadCache=[];d.commands={bold:{execCommand:"bold",tooltip:"Bold"},italic:{execCommand:"italic",tooltip:"Italic"},underline:{execCommand:"underline",tooltip:"Underline"},strike:{execCommand:"strikethrough",tooltip:"Strikethrough"},subscript:{execCommand:"subscript",tooltip:"Subscript"},superscript:{execCommand:"superscript",tooltip:"Superscript"},left:{execCommand:"justifyleft",tooltip:"Align left"},center:{execCommand:"justifycenter",tooltip:"Center"},right:{execCommand:"justifyright",tooltip:"Align right"},justify:{execCommand:"justifyfull",tooltip:"Justify"},font:{execFunction:function(e){var h=d.options.fonts.split(",");var g=a("<span />");for(var f=0;f<h.length;f++){g.append(a('<a class="sceditor-font-option"><font face="'+h[f]+'">'+h[f]+"</font></a>").data("sceditor-font",h[f]).click(function(i){d.execCommand("fontname",a(this).data("sceditor-font"));d.closeDropDown();d.focus();i.preventDefault()}))}d.createDropDown(e,"font-picker",g)},tooltip:"Font Name"},size:{execFunction:function(e){var g=a("<span />");for(var f=1;f<=7;f++){g.append(a('<a class="sceditor-fontsize-option"><font size="'+f+'">'+f+"</font></a>").data("sceditor-fontsize",f).click(function(h){d.execCommand("fontsize",a(this).data("sceditor-fontsize"));d.closeDropDown();d.focus();h.preventDefault()}))}d.createDropDown(e,"fontsize-picker",g)},tooltip:"Font Size"},color:{execFunction:function(g){var f={r:255,g:255,b:255};var l=a("<span />");var k=d.options.colors?d.options.colors.split("|"):new Array(21);for(var j=0;j<k.length;j++){var n=a('<div class="sceditor-color-column" />');var e=(typeof k[j]!="undefined")?k[j].split(","):new Array(21);for(var m=0;m<e.length;m++){var h=(typeof e[m]!="undefined")?e[m]:"#"+f.r.toString(16)+f.g.toString(16)+f.b.toString(16);n.append(a(document.createElement("a")).css({background:h}).addClass("sceditor-color-option").data("sceditor-color",h).click(function(i){d.execCommand("forecolor",a(this).data("sceditor-color"));d.closeDropDown();d.focus();i.preventDefault()}));if(m%5==0){f={r:f.r,g:f.g-51,b:255}}else{f={r:f.r,g:f.g,b:f.b-51}}}l.append(n);if(j%5==0){f={r:f.r-51,g:255,b:255}}else{f={r:f.r,g:255,b:255}}}d.createDropDown(g,"color-picker",l)},tooltip:"Font Color"},removeformat:{execCommand:"removeformat",tooltip:"Remove Formatting"},cut:{execCommand:"cut",tooltip:"Cut",errorMessage:"Your browser dose not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{execCommand:"copy",tooltip:"Copy",errorMessage:"Your browser dose not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{execCommand:"paste",tooltip:"Paste",errorMessage:"Your browser dose not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{execFunction:function(e){var f=a('<form><div><label for="txt">Paste your text inside the following								 box:</label> <textarea cols="20" rows="7" id="txt"></textarea>								</div></form>').submit(function(){return false});f.append(a('<div><input type="button" value="Insert" /></div>').click(function(g){d.wysiwygEditorInsertText(a(this).parent("form").find("#txt").val());d.closeDropDown();d.focus();g.preventDefault()}));d.createDropDown(e,"pastetext",f)},tooltip:"Paste Text"},bulletlist:{execCommand:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{execCommand:"insertorderedlist",tooltip:"Numbered list"},undo:{execCommand:"undo",tooltip:"Undo"},redo:{execCommand:"redo",tooltip:"Redo"},table:{execFunction:function(e){var f=a('<form>						<div><label for="rows">Rows:</label><input type="text" id="rows" value="2" /></div>						<div><label for="cols">Cols:</label><input type="text" id="cols" value="2" /></div>						</form>').submit(function(){return false});f.append(a('<div><input type="button" value="Insert" /></div>').click(function(k){var i=a(this).parent("form").find("#rows").val()-0;var j=a(this).parent("form").find("#cols").val()-0;var h="<table>";for(var l=0;l<i;l++){h+="<tr>";for(var g=0;g<j;g++){if(a.browser.msie){h+="<td></td>"}else{h+='<td><br class="sceditor-ignore" /></td>'}}h+="</tr>"}h+="</table>";d.wysiwygEditorInsertHtml(h);d.closeDropDown();d.focus();k.preventDefault()}));d.createDropDown(e,"inserttable",f)},tooltip:"Insert a table"},horizontalrule:{execCommand:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{execFunction:function(e){d.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{execFunction:function(e){var f=a('<form><div><label for="link">URL:</label> <input type="text" id="image" value="http://" /></div></form>').submit(function(){return false});f.append(a('<div><input type="button" value="Insert" /></div>').click(function(g){var h=a(this).parent("form").find("#image").val();if(h!=""&&h!="http://"){d.wysiwygEditorInsertHtml('<img src="'+h+'" />')}d.closeDropDown();d.focus();g.preventDefault()}));d.createDropDown(e,"insertimage",f)},tooltip:"Insert an image"},email:{execFunction:function(e){var f=a('<form><div><label for="email">E-mail:</label> <input type="text" id="email" value="" /></div></form>').submit(function(){return false});f.append(a('<div><input type="button" value="Insert" /></div>').click(function(g){var h=a(this).parent("form").find("#email").val();if(h!=""){d.focus();if(d.getWysiwygSelection().type=="None"||d.getWysiwygSelection().type=="Caret"){d.wysiwygEditorInsertHtml('<a href="mailto:'+h+'">'+h+"</a>")}else{d.execCommand("createlink","mailto:"+h)}}d.closeDropDown();d.focus();g.preventDefault()}));d.createDropDown(e,"insertemail",f)},tooltip:"Insert an email"},link:{execFunction:function(e){var f=a('<form><div><label for="link">URL:</label> <input type="text" id="link" value="http://" /></div></form>').submit(function(){return false});f.append(a('<div><input type="button" value="Insert" /></div>').click(function(g){var h=a(this).parent("form").find("#link").val();if(h!=""&&h!="http://"){d.focus();if(d.getWysiwygSelection().type=="None"||d.getWysiwygSelection().type=="Caret"){d.wysiwygEditorInsertHtml('<a href="'+h+'">'+h+"</a>")}else{d.execCommand("createlink",h)}}d.closeDropDown();d.focus();g.preventDefault()}));d.createDropDown(e,"insertlink",f)},tooltip:"Insert a link"},unlink:{execCommand:"unlink",tooltip:"Unlink"},quote:{execFunction:function(e){d.wysiwygEditorInsertHtml("<blockquote>","<br /></blockquote>")},tooltip:"Insert a Quote"},emoticon:{execFunction:function(f){var h=a("<div />");var e=a("<div />");var g=a("<div />");a.each(d.options.emoticons.dropdown,function(j,i){e.append(a('<img src="'+i+'" />').data("sceditor-emoticon",j).click(function(k){a(this).data("sceditor-emoticon");d.wysiwygEditorInsertHtml('<img src="'+a(this).attr("src")+'" data-sceditor-emoticon="'+a(this).data("sceditor-emoticon")+'" />');d.closeDropDown();d.focus();k.preventDefault()}));if(e.children().length>3){h.append(e);e=a("<div />")}});if(e.children().length>0){h.append(e)}if(typeof d.options.emoticons.more!="undefined"){var g=a('<a class="sceditor-more">More</a>').click(function(){var i=a.extend({},d.options.emoticons.dropdown,d.options.emoticons.more);h=a("<div />");a.each(i,function(k,j){e.append(a('<img src="'+j+'" />').data("sceditor-emoticon",k).click(function(l){a(this).data("sceditor-emoticon");d.wysiwygEditorInsertHtml('<img src="'+a(this).attr("src")+'" data-sceditor-emoticon="'+a(this).data("sceditor-emoticon")+'" />');d.closeDropDown();d.focus();l.preventDefault()}));if(e.children().length>4){h.append(e);e=a("<div />")}});if(e.children().length>0){h.append(e)}d.createDropDown(f,"insertemoticon",h)});h.append(g)}d.createDropDown(f,"insertemoticon",h)},keyPress:function(h){var f=null;if(d.wysiwygEditor.contentWindow&&d.wysiwygEditor.contentWindow.getSelection){f=d.wysiwygEditor.contentWindow.getSelection().getRangeAt(0)}if(f==null){return}var g=a.extend({},d.options.emoticons.more,d.options.emoticons.dropdown);a.each(g,function(k,j){var l="";if(f.startContainer){var e=k.length-1;var m=(f.startOffset>e?f.startOffset-e:0);var i=(f.startOffset>e?e:f.startOffset);l=f.startContainer.textContent.substr(m,i)}l+=String.fromCharCode(h.which);if(l==k){f.setStart(f.startContainer,m);f.deleteContents();d.wysiwygEditorInsertHtml('<img src="'+j+'" data-sceditor-emoticon="'+k+'" />');h.preventDefault();h.stopPropagation();return false}})},tooltip:"Insert an emoticon"},date:{execFunction:function(g){var f=new Date();var h=f.getYear();var i=f.getMonth();var e=f.getDate();if(h<2000){h=1900+h}if(i<10){i="0"+i}if(e<10){e="0"+e}d.wysiwygEditorInsertHtml("<span>"+h+"-"+i+"-"+e+"</span>")},tooltip:"Insert current date"},time:{execFunction:function(g){var f=new Date();var e=f.getHours();var i=f.getMinutes();var h=f.getSeconds();if(e<10){e="0"+e}if(i<10){i="0"+i}if(h<10){h="0"+h}d.wysiwygEditorInsertHtml("<span>"+e+":"+i+":"+h+"</span>")},tooltip:"Insert current time"},print:{execCommand:"print",tooltip:"Print"},source:{execFunction:function(e){d.toggleTextMode()},tooltip:"View source"}};d.init=function(){d.$textarea.data("sceditor",d);d.options=a.extend({},a.sceditor.defaultOptions,b);if(d.options.height!=null){d.$textarea.height(d.options.height)}if(d.options.width!=null){d.$textarea.width(d.options.width)}d.editorContainer=a('<div class="sceditor-container" />').height(d.$textarea.outerHeight()).width(d.$textarea.outerWidth());d.$textarea.after(d.editorContainer);d.initToolBar();d.initEditor();d.initKeyPressFuncs();d.$textarea.parents("form").submit(function(){if(d.$textEeditor.is(":visible")){d.toggleTextMode()}d.$textarea.val(d.getWysiwygEditorValue())});a(document).click(d.documentClickHandler);var e=d.$textarea.hide().val();if(d.options.getTextHandler){e=d.options.getTextHandler(e)}d.setWysiwygEditorValue(e);d.preLoadEmoticons()};d.initEditor=function(){var f,g;var e=d.$textarea.height()-(d.options.toolbarContainer===null?d.$toolbar.outerHeight():0);var h=d.$textarea.width();d.$textEeditor=a("<textarea></textarea>").hide().height(e).width(h);d.$wysiwygEditor=a(window.location.protocol!=="https:"?"<iframe></iframe>":'<iframe src="javascript:false"></iframe>').attr("frameborder",0).height(e).width(h);d.editorContainer.append(d.$wysiwygEditor).append(d.$textEeditor);d.wysiwygEditor=d.$wysiwygEditor[0];f=d.$wysiwygEditor.height();g=d.$wysiwygEditor.width();d.$wysiwygEditor.height(f+((f-d.$wysiwygEditor.outerHeight(true))/2));d.$wysiwygEditor.width(g+((g-d.$wysiwygEditor.outerWidth(true))/2));f=d.$textEeditor.height();g=d.$textEeditor.width();d.$textEeditor.height(f+((f-d.$textEeditor.outerHeight(true))/2));d.$textEeditor.width(g+((g-d.$textEeditor.outerWidth(true))/2));d.getWysiwygDoc().designMode="On";d.getWysiwygDoc().open();d.getWysiwygDoc().write('<html><head><link rel="stylesheet" type="text/css" href="'+d.options.style+'" /></head><body></body></html>');d.getWysiwygDoc().close();a(d.getWysiwygDoc()).find("body").keypress(d.handleKeyPress);a(d.getWysiwygDoc()).keypress(d.handleKeyPress);a(d.getWysiwygDoc()).mousedown(d.handleMouseDown);a(d.getWysiwygDoc()).bind("beforedeactivate keypress",d.saveRange)};d.initToolBar=function(){d.$toolbar=a('<div class="sceditor-toolbar" />');var f=d.options.toolbar.split("|");for(var h=0;h<f.length;h++){var k=a('<div class="sceditor-group" />');var j=f[h].split(",");for(var e=0;e<j.length;e++){if(!d.commands.hasOwnProperty(j[e])){continue}var g=a('<a class="sceditor-button sceditor-button-'+j[e]+' "><div /></a>');if(d.commands[j[e]].hasOwnProperty("tooltip")){g.attr("title",d.commands[j[e]].tooltip)}g.data("sceditor-command",j[e]);g.click(function(i){d.handleCommand(a(this),d.commands[a(this).data("sceditor-command")]);i.preventDefault()});k.append(g)}d.$toolbar.append(k)}if(d.options.toolbarContainer===null){d.editorContainer.append(d.$toolbar)}else{a(d.options.toolbarContainer).append(d.$toolbar)}};d.initKeyPressFuncs=function(){a.each(d.commands,function(f,e){if(typeof e.keyPress!="undefined"){d.keyPressFuncs.push(e.keyPress)}})};d.preLoadEmoticons=function(){var e=a.extend({},d.options.emoticons.more,d.options.emoticons.dropdown);a.each(e,function(h,f){var g=document.createElement("img");g.src=f;d.preLoadCache.push(g)})};d.createDropDown=function(f,h,g){if(d.$dropdown!=null){d.closeDropDown()}var e=f.position();d.$dropdown=a('<div class="sceditor-dropdown sceditor-'+h+'" />').css({top:e.top,left:e.left}).append(g);d.editorContainer.after(d.$dropdown);d.dropdownIgnoreLastClick=true;d.$dropdown.click(function(i){i.stopPropagation()})};d.documentClickHandler=function(){if(!d.dropdownIgnoreLastClick){d.closeDropDown()}d.dropdownIgnoreLastClick=false};d.closeDropDown=function(){if(d.$dropdown!=null){d.$dropdown.remove();d.$dropdown=null}};d.getWysiwygDoc=function(){if(d.wysiwygEditor.contentDocument){return d.wysiwygEditor.contentDocument}if(d.wysiwygEditor.contentWindow&&d.wysiwygEditor.contentWindow.document){return d.wysiwygEditor.contentWindow.document}if(d.wysiwygEditor.document){return d.wysiwygEditor.document}return null};d.wysiwygEditorInsertHtml=function(f,h){if(a(d.getWysiwygSelectedContainerNode()).is("code")||a(d.getWysiwygSelectedContainerNode()).parents("code").length!==0){return}d.focus();if(typeof h!="undefined"){f=f+d.getWysiwygSelectedHtml()+h}if(d.getWysiwygDoc().getSelection){var e=d.getWysiwygSelection();var g=d.getWysiwygDoc().createElement("div");g.innerHTML=f;g=g.children[0];e.deleteContents();e.insertNode(g);e=e.cloneRange();e.setStartAfter(g);d.wysiwygEditor.contentWindow.getSelection().removeAllRanges();d.wysiwygEditor.contentWindow.getSelection().addRange(e)}else{if(d.getWysiwygDoc().selection&&d.getWysiwygDoc().selection.createRange){d.getWysiwygDoc().selection.createRange().pasteHTML(f)}else{d.execCommand("insertHtml",f)}}d.lastRange=null};d.wysiwygEditorInsertText=function(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/ /g,"&nbsp;");e=e.replace(/\r\n|\r/g,"\n");e=e.replace(/\n/g,"<br />");d.wysiwygEditorInsertHtml(e)};d.getWysiwygSelection=function(){var e;if(d.wysiwygEditor.contentWindow&&d.wysiwygEditor.contentWindow.getSelection){e=d.wysiwygEditor.contentWindow.getSelection()}else{if(d.getWysiwygDoc().selection){e=d.getWysiwygDoc().selection}}if(e.getRangeAt){return e.getRangeAt(0)}else{if(e.createRange){return e.createRange()}}return null};d.getWysiwygSelectedHtml=function(){var f=d.getWysiwygSelection();if(f===null){return""}if(document.selection&&document.selection.createRange){if(typeof f.htmlText!="undefined"){return f.htmlText}else{if(f.length>=1){return f.item(0).outerHTML}}}if(window.getSelection&&window.XMLSerializer){var e="";a(f.cloneContents().childNodes).each(function(){e+=new XMLSerializer().serializeToString(this)});return e}};d.getWysiwygSelectedContainerNode=function(){var e=d.getWysiwygSelection();if(e===null){return null}if(document.selection&&document.selection.createRange){return e.parentElement}if(window.getSelection&&window.XMLSerializer){return e.commonAncestorContainer}};d.getWysiwygEditorValue=function(){var e=d.$wysiwygEditor.contents().find("body").html();if(d.options.getHtmlHandler){e=d.options.getHtmlHandler(e,d.$wysiwygEditor.contents().find("body"))}return e};d.getTextareaValue=function(){var e=d.$textEeditor.val();if(d.options.getTextHandler){e=d.options.getTextHandler(e)}return e};d.setWysiwygEditorValue=function(e){e=d.replaceEmoticons(e);d.getWysiwygDoc().body.innerHTML=e};d.setTextareaValue=function(e){d.$textEeditor.val(e)};d.replaceEmoticons=function(e){var f=a.extend({},d.options.emoticons.more,d.options.emoticons.dropdown);a.each(f,function(h,g){var i=h.replace(/[\$\?\[\]\.\*\(\)\|]/g,"\\$&").replace("<","&lt;").replace(">","&gt;")+"(?=([^<>]*?<|[^<>]*?$))";e=e.replace(new RegExp(i,"g"),'<img src="'+g+'" data-sceditor-emoticon="'+h+'" />')});return e};d.toggleTextMode=function(){if(d.$textEeditor.is(":visible")){d.setWysiwygEditorValue(d.getTextareaValue())}else{d.setTextareaValue(d.getWysiwygEditorValue())}d.lastRange=null;d.$textEeditor.toggle();d.$wysiwygEditor.toggle()};d.handleCommand=function(e,f){if(f.hasOwnProperty("execFunction")){f.execFunction(e)}else{d.execCommand(f.execCommand,f.hasOwnProperty("execParam")?f.execParam:null)}};d.focus=function(){d.wysiwygEditor.contentWindow.focus();if(d.lastRange!=null){if(window.document.createRange){window.getSelection().addRange(d.lastRange)}else{if(window.document.selection){d.lastRange.select()}}}};d.saveRange=function(){if(!a.browser.msie){return}d.lastRange=d.getWysiwygSelection()};d.execCommand=function(i,h){var f=false;d.focus();if(a(d.getWysiwygSelectedContainerNode()).is("code")||a(d.getWysiwygSelectedContainerNode()).parents("code").length!==0||a(d.getWysiwygSelectedContainerNode()).find("code").length!==0){return}if(d.getWysiwygDoc()){try{f=d.getWysiwygDoc().execCommand(i,false,h)}catch(g){alert("Error: "+g)}}if(!f&&typeof d.commands[i]!="undefined"&&typeof d.commands[i].errorMessage!="undefined"){alert(d.commands[i].errorMessage)}};d.handleKeyPress=function(f){d.closeDropDown();if(a(d.getWysiwygSelectedContainerNode()).is("code")||a(d.getWysiwygSelectedContainerNode()).parents("code").length!==0){return}a.each(d.keyPressFuncs,function(e,g){g(f)})};d.handleMouseDown=function(f){d.closeDropDown()};d.init()};a.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist|undo,redo|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,date,time|print,source",style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png",":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,getHtmlHandler:null,getTextHandler:null,toolbarContainer:null};a.fn.sceditor=function(b){return this.each(function(){(new a.sceditor(this,b))})}})(jQuery);(function(a){a.sceditorBBCodePlugin=function(c,b){var d=this;d.bbcodes={b:{styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},left:{styles:{"text-align":["left"]},format:"[left]{0}[/left]",html:'<div style="text-align: left">{0}</div>'},center:{styles:{"text-align":["center"]},format:"[center]{0}[/center]",html:'<div style="text-align: center">{0}</div>'},right:{styles:{"text-align":["right"]},format:"[right]{0}[/right]",html:'<div style="text-align: right">{0}</div>'},justify:{styles:{"text-align":["justify"]},format:"[justify]{0}[/justify]",html:'<div style="text-align: justify">{0}</div>'},font:{styles:{"font-family":null},format:function(e,f){if(e.css("font-family")==d.options.defaultFont){return f}return"[font="+d.stripQuotes(e.css("font-family"))+"]"+f+"[/font]"},html:function(f,e,g){return'<font face="'+e.defaultAttr+'">'+g+"</font>"}},size:{styles:{"font-size":null},format:function(f,g){var h=f.css("fontSize");var e=1;if(h==d.options.defaultSize){return g}if(h.indexOf("px")>-1){h=h.replace("px","")-0;if(h>12){e=2}if(h>15){e=3}if(h>17){e=4}if(h>23){e=5}if(h>31){e=6}if(h>47){e=7}}else{e=h}return"[size="+e+"]"+g+"[/size]"},html:function(f,e,g){return'<font size="'+e.defaultAttr+'">'+g+"</font>"}},color:{styles:{color:null},format:function(f,g){var e=d.rgbToHex(f.css("color"));if(e==d.options.defaultColor){return g}return"[color="+e+"]"+g+"[/color]"},html:function(f,e,g){return'<font color="'+e.defaultAttr+'">'+g+"</font>"}},ul:{tags:{ul:null},format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{html:"<ul>{0}</ul>"},ol:{tags:{ol:null},format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{html:"<li>{0}</li>"},table:{tags:{table:null},format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},format:"[td]{0}[/td]",html:'<td>{0}<br class="sceditor-ignore" /></td>'},emoticon:{tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,f){return e.attr("data-sceditor-emoticon")+f},html:"{0}"},horizontalrule:{tags:{hr:null},format:"[hr]{0}",html:"<hr />"},img:{tags:{img:{src:null}},format:function(e,f){var g="";if(typeof e.attr("data-sceditor-emoticon")!="undefined"){return f}if(typeof e.attr("width")!="undefined"){g+=" width="+e.attr("width")}if(typeof e.attr("height")!="undefined"){g+=" height="+e.attr("height")}return"[img"+g+"]"+e.attr("src")+"[/img]"},html:function(f,e,g){var h="";if(typeof e.width!="undefined"){h+=' width="'+e.width+'"'}if(typeof e.height!="undefined"){h+=' height="'+e.width+'"'}return"<img "+h+' src="'+g+'" />'}},url:{tags:{a:{href:null}},format:function(e,f){if(e.attr("href").substr(0,7)=="mailto:"){return"[email="+e.attr("href").substr(7)+"]"+f+"[/email]"}return"[url="+encodeURI(e.attr("href")).replace("=","%3D")+"]"+f+"[/url]"},html:function(f,e,g){if(typeof e.defaultAttr=="undefined"){e.defaultAttr=g}return'<a href="'+e.defaultAttr+'">'+g+"</a>"}},email:{html:function(f,e,g){if(typeof e.defaultAttr=="undefined"){e.defaultAttr=g}return'<a href="mailto:'+e.defaultAttr+'">'+g+"</a>"}},quote:{tags:{blockquote:null},format:function(f,g){var e="";if(a(f).children("cite:first").length==1){e="="+a(f).children("cite:first").text();g="";a(f).children("cite:first").remove();a(f).contents().each(function(){g+=d.elementToBbcode(a(this))})}return"[quote"+e+"]"+g+"[/quote]"},html:function(f,e,g){if(typeof e.defaultAttr!="undefined"){g="<cite>"+e.defaultAttr+"</cite>"+g}return"<blockquote>"+g+"</blockquote>"}},code:{tags:{code:null},format:"[code]{0}[/code]",html:"<code>{0}</code>"}};d.tagsToBbcodes={};d.stylesToBbcodes={};d.init=function(){d.options=a.extend({},a.sceditor.defaultOptions,a.sceditorBBCodePlugin.defaultOptions,b);d.buildBbcodeCache();(new a.sceditor(c,a.extend({},d.options,{getHtmlHandler:d.getHtmlHandler,getTextHandler:d.getTextHandler})))};d.rgbToHex=function(f){var e;if(e=f.match(/rgb\((\d+),\s*?(\d+),\s*?(\d+)\)/i)){return"#"+(e[1]-0).toString(16)+(e[2]-0).toString(16)+(e[3]-0).toString(16)}return f};d.buildBbcodeCache=function(){a.each(d.bbcodes,function(e,f){if(typeof d.bbcodes[e].tags!="undefined"){a.each(d.bbcodes[e].tags,function(g,h){d.tagsToBbcodes[g]=(d.tagsToBbcodes[g]||{});d.tagsToBbcodes[g][e]=h})}if(typeof d.bbcodes[e].styles!="undefined"){a.each(d.bbcodes[e].styles,function(h,g){d.stylesToBbcodes[h]=(d.stylesToBbcodes[h]||{});d.stylesToBbcodes[h][e]=g})}})};d.handleStyles=function(e,f){a.each(d.stylesToBbcodes,function(h,g){if(e.get(0).nodeName.toLowerCase()=="a"&&(h=="color"||h=="text-decoration")){return}else{if(e.get(0).nodeName.toLowerCase()=="code"&&(h=="font-family")){return}}elementPropVal=e.css(h);if(e.parent().css(h)==elementPropVal){return}a.each(g,function(j,i){if(i==null||a.inArray(elementPropVal.toString(),i)>-1){if(a.isFunction(d.bbcodes[j].format)){f=d.bbcodes[j].format(e,f)}else{f=d.formatString(d.bbcodes[j].format,f)}}})});return f};d.handleTags=function(f,g){var e=f.get(0).nodeName.toLowerCase();if(typeof d.tagsToBbcodes[e]!="undefined"){a.each(d.tagsToBbcodes[e],function(i,j){var h=false;if(j==null){h=true}else{a.each(j,function(l,k){if(typeof f.attr(l)=="undefined"){return}if(k!=null&&a.inArray(f.attr(l),k)<0){return}h=true;return false})}if(!h){return}if(a.isFunction(d.bbcodes[i].format)){g=d.bbcodes[i].format(f,g)}else{g=d.formatString(d.bbcodes[i].format,g)}})}if(e=="br"||e=="div"||e=="p"){g+="\n"}return g};d.formatString=function(){var e=arguments;return e[0].replace(/{(\d+)}/g,function(g,f){return typeof e[0-f+1]!="undefined"?e[0-f+1]:"{"+f+"}"})};d.stripQuotes=function(e){return e.replace(/^["']+/,"").replace(/["']+$/,"")};d.getHtmlHandler=function(e,f){return d.elementToBbcode(a(f))};d.elementToBbcode=function(f){if(typeof f.get(0)==="undefined"){return""}if(f.get(0).nodeType===3){return f.get(0).nodeValue}var e="";if(f.is("code")){e=f.text()}else{if(f.contents().length>0){a.each(f.contents(),function(){e+=d.elementToBbcode(a(this))})}}if(!f.is("code")){e=d.handleStyles(f,e)}e=d.handleTags(f,e);return e};d.getTextHandler=function(h){var g=/\[([^\[\s=]*?)(?:([^\[]*?))?]((?:[\s\S(?!=\[\\\1)](?!\[\1))*?)\[\/(\1)\]/g;var f=/(\S+)=((?:(?:(["'])(?:\\\3|[^\3])*?\3))|(?:[^'"\s]+))/g;var e;h=h.replace(/&/g,"&amp;");h=h.replace(/</g,"&lt;");h=h.replace(/>/g,"&gt;");h=h.replace(/\r/g,"");h=h.replace(/(\[\/?(?:left|center|right|justify)\])\n/g,"$1");h=h.replace(/\n/g,"<br />");while(h!=e){e=h;h=h.replace(g,function(n,j,i,l){var k={};if(typeof i!="undefined"){var m;i=a.trim(i);if(i.charAt(0)=="="&&(i.split("=").length-1)<=1){k.defaultAttr=d.stripQuotes(i.substr(1))}else{if(i.charAt(0)=="="){i="defaultAttr"+i}while((m=f.exec(i))){k[m[1].toLowerCase()]=d.stripQuotes(m[2])}}}if(typeof d.bbcodes[j]=="undefined"){return n}if(a.isFunction(d.bbcodes[j].html)){return d.bbcodes[j].html(j,k,l)}else{return d.formatString(d.bbcodes[j].html,l)}})}h=h.replace(/\[hr\]/gi,"<hr>");return h.replace(/  (?=([^\<\>]*?<|[^\<\>]*?$))/g," &nbsp;")};d.init()};a.sceditorBBCodePlugin.defaultOptions={defaultSize:13,defaultColor:"#111111",defaultFont:"Verdana, Arial, Helvetica, sans-serif"};a.fn.sceditorBBCodePlugin=function(b){return this.each(function(){(new a.sceditorBBCodePlugin(this,b))})}})(jQuery);